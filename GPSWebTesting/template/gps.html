 <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>GPS en tiempo real</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
    <h2>Seguimiento GPS</h2>
    <button onclick="sendLocation()">Enviar mi ubicación</button>
    <div id="map" style="height:400px; width:100%; margin-top:10px;"></div>

    <script>
        // --- Enviar ubicación cada 5 segundos ---
        function sendLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(function(position) {
                    fetch("/api/locations/", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        })
                    });
                });
            } else {
                alert("Geolocalización no soportada");
            }
        }

        // --- Configurar mapa Leaflet ---
        var map = L.map('map').setView([0, 0], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        var marker = L.marker([0, 0]).addTo(map);

        // --- Actualizar posición cada 5 segundos ---
        setInterval(async function() {
            let res = await fetch("/api/locations/");
            let data = await res.json();
            if (data.length > 0) {
                let last = data[0]; // último guardado (por order_by)
                marker.setLatLng([last.latitude, last.longitude]);
                map.setView([last.latitude, last.longitude]);
            }
        }, 5000);
    </script>
</body>
</html>
